module Services
  # Usage: 
  # fb_service = Services::Facebook.new(users_facebook_access_token)
  # fb_service.get_friends  # get hash of friends
  # fb_service.conn.get "/me"
  class Facebook < Services::Base
    # Not directly needed now, but eventualy we should sign all our fb requests with the hash of these,
    # see https://developers.facebook.com/docs/graph-api/securing-requests/
    # APP_ID = ConnectionCompass.settings.services["facebook"]["app_id"]
    # APP_SECRET = ConnectionCompass.settings.services["facebook"]["app_secret"]

    def initialize(access_token)
      validate_access_token!
      conn_options = {
        url: "http://graph.facebook.com",  
        params:  {access_token: access_token},
      }
      super(conn_options)
    end

    private
    def validate_access_token!(access_token)
      unless access_token.present? && access_token.length >= 64   # arbitrary, but it seems the min length
        raise ArgumentError, "Invalid Facebook Access Token Given (#{access_token})"
      end
    end
  end
end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 